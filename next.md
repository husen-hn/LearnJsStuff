# نکات و آموزش next.js

> _قبل از شروع بر اساس تحقیقاتی که داشتم این فریم ورک هم برای کار بزرگ و هم کوچیک امکانات خوبی داره پس به تبلیغات وب سایت ها که فقط برای کار های بزرگ هست توجه نکنید. به صورت مثال می تونه یک سری لینک ها که می دونید همیشه همون شکل هست رو به صورت اچ تی ام ال کپچر کنید و داخل پروژه داشته باشید مثلا. ۱۰۰ مطلب آخر وب سایت رو و این در ساخت یک وب سایت استاتیک بسیار آپشن خوبی هست. در کل این فریم ورک از جلمله اینکه مشکل پری رندرینگ برای SEO رو حل می کنه از روی ری اکت دیگر موارد رو هم براتون راحت می کنه از جمله امکاناتی که برای روتینگ در پروژه داره یا مدیریت فایل ها و استراکچر داخلی خودش شما رو فورس می کنه تا در ساختاری تقریبا استاندارد جلو برید. بر اساس جستجو اولیه وب سایت های بزرگ ایرانی از جمله اسنپ فود کافه بازار استفاده کننده همین فریم ورک هستند با اینکه اسنپ فود نیازی به سئو نداره تا سرور ساید رندر کنه ولی امکانات این فریم ورک بسیار جذاب هست_


```js
npx create-next-app@latest
npx create-next-app@latest --typescript
```

شروع تمامی مواردی که می خواهند سرور ساید رندر شود با _ اسم فایل شروع می شود و در HTML می توان دید که تمامی موارد در یک دایو با آیدی next قرار می گیرد

```html
<div id="__next">
```

---

### مسیردهی و فرق آن با React

در ری اکت شما مجبور به نصب یک کتابخانه جدا هستند که در کد می نویسید ولی در next.js این کار بر اساس فایل مسیر دهی می شود که کارو بسیار راحتر و همینطور جلوگیری می کند از کد های بسیار زیاد البته از نظر خودم این یک ویژگی بسیار بزرگ نیست بلکه می تونه تغییرات در سختتر بکنه ولی برای این هم سولوشن هایی داره که تا حالا زیاد دلچسب نبوده برام. شما باید حتما استراکچر رو بسیار دقت کنید تا حجم تغییرات برای شما زیاد نشه. برای ساخت هر صفحه یا مسیر می توانید در فولدر pages بیایید فولدر یا فایل js بسازید و دقیقا به همان اسم روتر خواهید داشت

---
### هوک مربوط به Router

در مسیر دهی مشکلات زیادی رو nextjs حل کرده به همین منظور شما می توانید هوک مربوط به اون که می شود useRouter و همینطور برای کلاس کامپوننت ها هم  withRouter
 استفاده کنید به صورت زیر
 ```js
 import { useRouter } from 'next/router';
 
 const PortfolioProjectPgae = () => {
  const router = useRouter();

  console.log(router.pathname)
  console.log(router.query)
}
```

---
### مسیر دهی تو در تو
شما می توانید در pages بیایید یک about.js بسازید که خود مسیر سایت شما می شود مثلا `test.com/about` یا می توانید بیایید یک فولدر بسازید به نام about و داخل اون بیایید یک index.js بسازید که بازم مسیر بالا می شود یا می توانید مثلا بیایید یک فولدر بسازید به نام blog و داخلش بیایید یک فایل بسازید به نام `[id].js` اینجوری شما می توانید مسیر `test.com/blog/1` را لود کنید یا هر اسمی که به عنوان پراپرتی id اون رو در نظر می گیره حالا شما می توانید حتی بزنید `[...slug].js` اینجوری اگر طرف بیاید بزنید `test.com/blog/12/22/the-test-router` به شما تمامی موارد بعد از بلاگ را به صورت آرایه تحویل می دهد. جالب هست بدانید حتی می توانید اسم فولدر را داینامیک بسازید مثل `[id]` و داخلش چندین مورد فایل js بسازید که بازم تو در تو می شود و تمامی نیاز هارو پوشش می دهد مخصوصا برای سئو


---
### در jsx از براکت استفاده نکنید بجای آن از پرانتز
در نمونه زیر ببنید
```js
<ul>
  {clients.map((item) => (
    <li key={item.id}>
      <Link href={`/clients/${item.id}`}>{item.name}</Link>
    </li>
  ))}
</ul>
```
همانطور که می بنید از ( استفاده شده است بعد از => اگر براکت بزارید چیزی در صفحه چاپ نمی شود

نکته: شما باید لیستی از آرایه را به jsx بدید پس باید از map استفاده کنید چون مواردی مثل forEach ریترن می کنند خط به خط و به همین منظور چیزی در صفحه چاپ نمی شود


---

### روش دیگر از لینک دهی و آپشن های Link در nextjs
خوب برخی مواقع ساختار یک لینک می تپاند پر از استرینگ و ... باشد و همینطور پارامتر در اون قرار بگیرید بخاطر همین nextjs اومده در دو `{{}}` موارد زیر را به صورت مثال قرار داده است که یکی مسیر و دیگری هم پارامتر های لینک می باشد

```js
<Link
  href={{
    pathname: '/clients/[id]',
    query: { id: client.id },
  }}
>
  {client.name}
</Link>
```

---
### نویگیت کردن به صورت کد
همانطور که در بالا مشاهده کردید ما هوک روتر از nextjs داریم که می تونیم به صورت زیر عمل کنیم
```js
const loadProjectHandler = () => {
    router.push('/clients/max/projecta')
}
```
نکته: push هم می توانید مثل لینک pathname و همینطور query بگیرد.
```js
const loadProjectHandler = () => {
  router.push({
    pathname: '/clients/[id]/[clientprojectid]',
    query: { id: 'sha', clientprojectid: 'projecta' },
  });
};
```

---
### ساخت صفحه ۴۰۴
برای ساخت این صفحه کافیه در pages بیایید یک 404.js بسازید و هر کدی رو توش می تونید قرار بدید نمونه:

```js
const NotFoundPage = () => {
  return (
    <div>
      <h1>Page Custom Not Found</h1>
    </div>
  );
};

export default NotFoundPage;
```

---
### استفاده از انکر تگ در لینک کامپوننت
برخی مواقع نیاز هست a تگ برای استایل دهی استفاده بشه وقتی بین Link استفاده می شه دیگه از لینک معمولی استفاده نمی کنه و براش href نباید بزارید به صورت مثال
```js
<Link href={props.Link}>
  <a className={classes.btn}>
    {props.children}
  </a>
</Link>
```

نکته: در صورتی که توابع پر ریلود رو استفاده نکنید سورس باز مثل ری اکت می شه و داخل سورس چیزی نیست یا اولین بلاک اچ تی ام ال می یاد. در حقیقت پراپس ریلود نمی شه

---
### ساخت صفحات استاتیک در nextjs
ممکن است برخی از صفحات مشکلی نباشد که یک بار لود گردد و همیشه از فایل آماده جنریت شده استفاده شود این تاثیر بسیار زیادی در سرعت و ... می گذارد مخصوصا روی CDN ها نیز کش می شود. مثلا ۳۰ مطلب پرطرفدار شما که قرار نیست تفییر بکند nextjs برای این مورد یک تابع دارد که باید بیرون تابع خود کامپوننت لود گردد و سرور ساید می باشد. یعنی کاربر چیزی از آن نمی بیند بعد از ران شدن. جالب اینجاست که ماژول node را در خودش می آورد و بعد از انجام نیز حذف می کند


برای مثال با قطعه کد زیر ما یک فایل در روت که json می باشد را می گیریم و به پراپز می دهیم

```js
export async function getStaticProps() {
  const filePath = path.join(process.cwd(), 'data', 'dummy-backend.json');
  const jsonData = await fs.readFile(filePath);
  const data = JSON.parse(jsonData);

  return {
    props: {
      products: data.products,
    },
  };
}
```

حال در همان فایل js می توانیم به کامپوننت خود بدهیم که از موردی که استاتیک جنریت شده است استفاده کند
```js
function Home(props) {
  const { products } = props;

  return (
    <ul>
      {products.map((product) => (
        <li key={product.id}>{product.title}</li>
      ))}
    </ul>
  );
}
```

---
### ساخت قسمت های استاتیک هر ۱۲۰ ثانیه
خوب فرض بر اینکه شما صفحات مورد نظر خود را ساختید ولی ممکن است چیز جدید به آن اضافه شود و می خواهید آن را بسازید که خوب از نظر منطقی زیاد به بخش کش کردن کمک نمی کند ولی در لود بسیار سریع خواهد بود نسبت به اینکه هر سری از دیتابیس بگیرید. به همین منظور شما باید به این صورت عمل کنید

```js
export async function getStaticProps() {
  console.log('Re Generate');
  const filePath = path.join(process.cwd(), 'data', 'dummy-backend.json');
  const jsonData = await fs.readFile(filePath);
  const data = JSON.parse(jsonData);

  return {
    props: {
      products: data.products,
    },
    revalidate: 120,
  };
}
```

همانطور که می بنید revalidate به کد قبلی اضافه شده است که عددش بر اساس ثانیه است و خودتون می تونید تغییر بر اساس نیاز خودتان بدهید

اطلاعات بیشتر: https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration#on-demand-revalidation

> نکته این مورد برای بخش پروداکشن می باشد چون در دولپر مود هر سری رکواست می فرستید صفحه ریجنریت می شود
